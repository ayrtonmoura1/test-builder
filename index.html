<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Avalia√ß√µes</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script defer src="https://unpkg.com/mathlive"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <aside class="toolbar no-print">
        <div class="logo-area">
            <i class="ph ph-exam"></i>
            <h2>Construtor de avalia√ß√µes</h2>
        </div>
        
        <div class="tools-section config-section">
            <label class="config-label">
                Tamanho da Fonte Global:
                <select id="fontSizeSelect" onchange="app.changeFontSize()">
                    <option value="12px">Padr√£o (12px)</option>
                    <option value="14px">Confort√°vel (14px)</option>
                    <option value="16px">Grande (16px)</option>
                    <option value="18px">Extra (18px)</option>
    
                </select>
            </label>
        </div>

        <div class="tools-section">
            <h3>Estrutura</h3>
            <div class="btn-grid">
                <button class="btn-primary btn-full" onclick="app.addQuestion()"><i class="ph ph-plus-circle"></i> Inserir Quest√£o</button>
                <button onclick="app.addTextBlock()"><i class="ph ph-text-t"></i> Texto Livre</button>
                <button onclick="app.addDivider()"><i class="ph ph-minus"></i> Separador</button>
                <button class="btn-full" onclick="app.addSpacer()"><i class="ph ph-bounding-box"></i> Inserir Bloco Vazio</button>
            </div>
        </div>

        <div class="tools-section">
            <h3>Layout da Prova</h3>
            <div class="btn-grid">
                <button class="btn-secondary btn-full" onclick="app.toggleColumns()" id="btnToggleColumns">
                    <i class="ph ph-columns"></i> Mudar para 2 Colunas
                </button>
            </div>
        </div>

        <div class="tools-section">
            <h3>Banco de Dados</h3>
            <div class="btn-grid">
    <button class="btn-import" onclick="document.getElementById('importUpload').click()"><i class="ph ph-upload-simple"></i> Importar</button>
    <input type="file" id="importUpload" accept=".json" class="no-print" style="display: none;" onchange="app.importJSON(event)">
    <button class="btn-export" onclick="app.exportJSON()"><i class="ph ph-download-simple"></i> Exportar</button>
</div>
        </div>

        <div class="tools-section">
            <h3>Finalizar</h3>
            <div class="btn-grid">
                <button class="btn-secondary" onclick="window.print()"><i class="ph ph-printer"></i> PDF (Aluno)</button>
                <button class="btn-secondary" onclick="printWithAnswers()" style="background: #059669; border-color: #047857;"><i class="ph ph-chalkboard-teacher"></i> PDF (Professor)</button>
                <button class="btn-excel btn-full" onclick="app.exportXLSX()"><i class="ph ph-file-xls"></i> Gabarito em Excel</button>
            </div>
        </div>

        <div class="tools-section bottom-tools">
            <button class="btn-danger btn-full" onclick="app.clearData()"><i class="ph ph-trash"></i> Reiniciar Tudo</button>
        </div>
        <h5>Desenvolvido por <strong>Ayrton Moura Souza Lima</strong></h5>
    </aside>

    <main class="paper-container" onclick="app.handleGlobalClick(event)">
        <div id="paper" class="paper">
            
            <header class="exam-header">
                <div class="header-main">
                    <div class="header-logo">
                        <label for="logoUpload" class="image-upload-wrapper">
                            <div class="img-placeholder bg-logo" id="logoPlaceholder">
                                <span class="placeholder-text"><i class="ph ph-buildings"></i><br>Logo</span>
                            </div>
                            <img id="logoPreview" src="" alt="Logo" style="display: none;">
                            <div class="image-overlay no-print"><i class="ph ph-camera"></i></div>
                        </label>
                        <input type="file" id="logoUpload" accept="image/*" class="no-print" style="display: none;" onchange="app.handleLogoUpload(event)">
                    </div>
                    
                    <div class="header-info">
                        <div class="header-row title-row">
                            <span class="label">Avalia√ß√£o:</span>
                            <div class="editable-field" contenteditable="true" data-field="title" id="globalTestTitle" onblur="app.saveState()">Simulado Geral</div>
                        </div>
                        <div class="header-row">
                            <span class="label">Escola:</span>
                            <div class="editable-field" contenteditable="true" data-field="school" onblur="app.saveState()">Nome da Institui√ß√£o</div>
                        </div>
                        <div class="header-grid">
                            <div class="header-row">
                                <span class="label">Turma:</span>
                                <div class="editable-field" contenteditable="true" data-field="class" onblur="app.saveState()">3¬∫ Ano M√©dio</div>
                            </div>
                            <div class="header-row">
                                <span class="label">Data:</span>
                                <div class="editable-field" contenteditable="true" data-field="date" onblur="app.saveState()">__ / __ / 20__</div>
                            </div>
                        </div>
                        <div class="header-row signature-row">
                            <span class="label">Aluno(a):</span>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                </div>
                <div class="exam-instructions" contenteditable="true" data-field="instructions" onblur="app.saveState()">
                    <strong>Instru√ß√µes:</strong> Preencha o cabe√ßalho. Marque apenas uma alternativa por quest√£o. (Cole imagens e tabelas livremente).
                </div>
            </header>

            <div id="blocksContainer" class="blocks-container cols-1"></div>
        </div>
    </main>

    <div id="symbolModalOverlay" class="modal-overlay no-print" style="display: none;" onclick="if(event.target===this) app.closeSymbolModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Inserir Caracteres e Emojis</h3>
                <button class="modal-close" onclick="app.closeSymbolModal()">&times;</button>
            </div>
            <div class="modal-tabs">
                <button class="tab-btn active" onclick="app.switchTab('math', this)">Matem√°tica</button>
                <button class="tab-btn" onclick="app.switchTab('greek', this)">Grego</button>
                <button class="tab-btn" onclick="app.switchTab('arrows', this)">Setas</button>
                <button class="tab-btn" onclick="app.switchTab('emojis', this)">Emojis</button>
            </div>
            <div class="modal-body modal-symbols-body">
                <div id="tab-math" class="symbol-grid active-grid"></div>
                <div id="tab-greek" class="symbol-grid"></div>
                <div id="tab-arrows" class="symbol-grid"></div>
                <div id="tab-emojis" class="emoji-container">
                    <emoji-picker></emoji-picker>
                </div>
            </div>
        </div>
    </div>

    <div id="bnccModalOverlay" class="modal-overlay no-print" style="display: none;" onclick="if(event.target===this) app.closeBnccModal()">
        <div class="modal-content" style="width: 750px; max-width: 95vw; height: 85vh; max-height: 650px; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3><i class="ph ph-list-numbers"></i> Consultar Habilidades BNCC</h3>
                <button class="modal-close" onclick="app.closeBnccModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 15px; display: flex; flex-direction: column; gap: 12px; height: 100%; overflow: hidden; background: #f8fafc;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <select id="bnccEtapa" onchange="app.updateBnccDisciplinas()" style="padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); font-size: 13px; font-weight: bold; color: var(--text-main); flex: 1;">
                        <option value="">1. Selecione a Etapa...</option>
                        <option value="infantil">Educa√ß√£o Infantil</option>
                        <option value="fundamental">Ensino Fundamental</option>
                        <option value="medio">Ensino M√©dio</option>
                    </select>
                    <select id="bnccDisciplina" disabled style="padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); font-size: 13px; font-weight: bold; color: var(--text-main); flex: 1;">
                        <option value="">2. Selecione a Disciplina/Campo...</option>
                    </select>
                    <button class="btn-primary" onclick="app.fetchBnccData()" style="padding: 8px 15px;"><i class="ph ph-magnifying-glass"></i> Buscar</button>
                </div>
                <div>
                    <input type="text" id="bnccSearchInput" placeholder="üîç Digite para filtrar os resultados abaixo por c√≥digo ou trecho do texto..." style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid var(--border-color); font-size: 13px;" oninput="app.filterBnccResults()">
                </div>
                <div id="bnccResults" style="flex: 1; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 6px; padding: 10px; background: white; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);">
                    <p style="text-align: center; color: var(--text-muted); margin-top: 30px;">
                        <i class="ph ph-books" style="font-size: 40px; opacity: 0.5;"></i><br>
                        Utilize os filtros acima e clique em "Buscar" para carregar as habilidades.
                    </p>
                </div>
                <div style="display: flex; justify-content: flex-end; padding-top: 10px; border-top: 1px solid var(--border-color);">
                    <button class="btn-primary" onclick="app.insertSelectedBncc()" style="font-size: 13px; padding: 10px 20px;"><i class="ph ph-check-square-offset"></i> Inserir Selecionadas no Bloco</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="print.js"></script> </body>
</body>
</html>
